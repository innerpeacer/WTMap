<html>
<head>
    <meta charset='utf-8'/>
    <title>FacilityOrentation</title>
    <meta content='initial-scale=1,maximum-scale=1,user-scalable=no' name='viewport'/>
    <script src="wtmap-gl-v2.5.1.js"></script>
    <script src="helper.js"></script>
    <link href="floor-switch.css" rel="stylesheet" type="text/css">
    <link href="base.css" rel="stylesheet" type="text/css">
    <script src="facility_orientation.js"></script>
</head>
<body>

<div id='map'></div>

<script>
    console.log(wtmap.version);
    var buildingID = "00270007";
    var use3D = false;
    var map = new wtmap.WTMap({
        container: 'map',
        buildingID: buildingID,
        use3D: use3D,
        // _dataVersion: "v5",
    });

    map.on("click", function (evt) {

    });

    // 指路机所用图标
    map.loadImage('facility-orientation.png', function (error, image) {
        map.addImage('facility-orientation', image);
    });

    let facilityOrientation = new FacilityOrientation();
    // Todo：此处替换获取指路机位置
    let facilityLocation = wtmap.CoordProjection.lngLatToMercator(114.43176430517315, 30.61224717632375);
    facilityLocation.floor = 1;
    facilityOrientation.setLocation(facilityLocation);

    let facilityTarget = null;
    let ortLayer = new OrientationLayer('ort');

    let isReady = false;

    map.on("mapready", function (evt) {
        console.log("mapready");
        console.log("BaseZoom: " + map.getBaseZoom());
        initFloorSwitch(map);

        // 添加指路机方向配置图层
        ortLayer.addToMap(map);
        ortLayer.showOrientation(facilityOrientation);

        isReady = true;
    });

    // 移动鼠标刷新终点
    map.on('mousemove', function (evt) {
        // console.log(evt);
        if (!isReady) return;
        facilityTarget = wtmap.CoordProjection.lngLatToMercator(evt.lngLat.lng, evt.lngLat.lat);
        facilityOrientation.setTarget(facilityTarget);

        ortLayer.showOrientation(facilityOrientation);

        // Angle即为指路机的方向值
        // let angle = facilityOrientation.getAngle();
        // console.log(angle);
    });

    map.on("floorend", function (evt) {
        if (ortLayer) {
            ortLayer.setFloor(evt.mapInfo.floorNumber);
        }
    });
</script>

</body>
</html>
