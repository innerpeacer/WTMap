<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tracker</title>

    <meta content='initial-scale=1,maximum-scale=1,user-scalable=no' name='viewport'/>
    <script src="../wtmap/js/config-dev-2.5.1.js"></script>
    <link href="../wtmap/css/floor-switch.css" rel="stylesheet" type="text/css">

    <script src="tracker_helper.js"></script>
</head>
<body>

<div id='map'></div>

<script>
    console.log(wtmap.version);
    console.log(wtmap);
    var buildingID = wtmap.Utils.getParameter("buildingID");
    buildingID = buildingID ? buildingID : "05712001";
    var floor = wtmap.Utils.getParameter("floor");
    if (floor) floor = parseInt(floor);

    var http = new wtmap.HttpRequest();
    var map = new wtmap.WTMap({
        container: 'map',
        buildingID: buildingID,
        // use3D: false,
        use3D: true,
        _disableCache: true,
        maxZoom: 22,
        __disableGps: true,
        // _debugBeacon: true,
        usePbf: true,
        sprite: "http://localhost:8112/WTMapResource/sprites/MilitaryGames",
        // sprite: "https://gis.cx9z.com/backend-map/sprites/MilitaryGames/MilitaryGamesSprite",
        // glyphs: "http://47.97.173.242:8080/WTMapResource/glyphs/{fontstack}/{range}.pbf"
    });

    map.on("click", function (evt) {
        console.log("Zoom: " + map.getZoom());
        console.log(evt.lngLat);
    });

    var trackerLayer = createTrackerLayer("tracker");

    map.on("mapready", function (evt) {
        // console.log("mapready");
        initFloorSwitch(map);

        initHeatmapLayer(map);
        trackerLayer.addToMap(map);

        if (floor) map.setFloor(floor);

        // getData();
        setInterval(getData, 1000);
    });

    function getData() {
        // console.log("getData");

        http.requestData(getLocationDataUrl(), function (res) {
            // console.log("res");
            // console.log(res.data);

            trackerLayer.showLabelData(locationDataToGeojson(res.data));
            setHeatmapData(map, locationDataToGeojson(res.data));
        });
    }

</script>

</body>
</html>