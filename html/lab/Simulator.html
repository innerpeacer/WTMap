<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simulator</title>

    <script src="../../dist/lab.js"></script>
    <script src="../wtmap/js/config-dev-2.5.1.js"></script>

</head>
<body>

<button onclick="start()">Start</button>
<button onclick="cancel()">Cancel</button>
<button onclick="pause()">Pause</button>
<button onclick="resume()">Resume</button>

<br>
<br>
<label id="hint"></label>

<script>
    console.log("lab");
    console.log(lab);

    var sampleID = "00270003-80D782-2019-09-04_16:06:04";
    var path = "/WTMapService/lab/GetSamplePbf?sampleID=" + sampleID;
    var http = new wtmap.HttpRequest();
    var simulator = new lab.Simulator();

    function getData() {
        http.requestBlobData(path, function (data) {
            var parser = new lab.WTBleSampleParser(data);
            simulator.loadSimulationData(parser.toSimulatingData());
            start();
        }, function (error) {

        });
    }

    getData();

    simulator.on("will-start", function () {
        console.log("will-start");
    });

    simulator.on("did-start", function () {
        console.log("did-start");
    });

    simulator.on("did-cancel", function () {
        console.log("did-cancel");
    });

    simulator.on("did-pause", function () {
        console.log("did-pause");
    });

    simulator.on("will-resume", function () {
        console.log("will-resume");
    });

    simulator.on("did-resume", function () {
        console.log("did-resume");
    });

    simulator.on("did-finish", function () {
        console.log("did-finish");
    });

    var index = 0;
    simulator.on("replay", function (event) {
        // console.log("replay");
        var replay = event.data;
        // console.log(replay.data);
        showHint("Replay: " + replay.index + ", Data: " + replay.data.value);

        var data = replay.data.value;
        // console.log(data);
        // console.log(replay);
        if (replay.data.dataType == lab.SimulationDataType.Gps) {
            console.log("gps: " + data.index);
        }

        if (replay.data.dataType == lab.SimulationDataType.Ble) {
            console.log("ble: " + data.index);
        }
    });


    function start() {
        console.log("start");
        simulator.start();
    }

    function cancel() {
        console.log("cancel");
        simulator.cancel();
    }

    function pause() {
        console.log("pause");
        simulator.pause();
    }

    function resume() {
        console.log("resume");
        simulator.resume();
    }

    function showHint(hint) {
        document.getElementById("hint").innerHTML = hint;
    }
</script>

</body>
</html>
